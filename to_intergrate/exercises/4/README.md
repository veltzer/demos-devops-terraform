# How to Query the State

Terraform's state is a way in which Terraform is able to keep a cache of cloud infrastructure configuration and its
mapping to terraform objects.  The state is used to store information that is generated by the third party.  An example
of this would be EC2 instances, where the essential config is stored in the tf configuration files, but the instance 
ID has to be generated by AWS.  After AWS generates this ID, Terraform would record this information in the state.

There are many reasons why you would want to query a state for information, either via CLI or using Terraform's 
interpolation.  We will experiment with 3 ways this can be done.

### Launch Infrastructure

```bash
terraform init
terraform apply
```

### Command Line

Terraform has a CLI command called "show", which allows users to export useful information from the state in a way 
that can be easily grep'ed or awk'ed.

```bash
terraform show
```

You should see something like this below:

```
aws_s3_bucket.user_bucket:
  id = mlucas-20190110060051130400000001
  acceleration_status =
  acl = private
  arn = arn:aws:s3:::mlucas-20190110060051130400000001
  bucket = mlucas-20190110060051130400000001
  bucket_domain_name = mlucas-20190110060051130400000001.s3.amazonaws.com
  bucket_prefix = mlucas-
  bucket_regional_domain_name = mlucas-20190110060051130400000001.s3.amazonaws.com
  cors_rule.# = 0
  force_destroy = false
  hosted_zone_id = Z3AQBSTGFYJSTF
  lifecycle_rule.# = 0
  logging.# = 0
  region = us-east-1
  replication_configuration.# = 0
  request_payer = BucketOwner
  server_side_encryption_configuration.# = 0
  tags.% = 0
  versioning.# = 1
  versioning.0.enabled = true
  versioning.0.mfa_delete = false
  website.# = 0
```

### Remote State Data Type

State is not always stored in a file local to the config.  If you are using one of these datatypes, you can use the 
remote state data type to parse remote state with interpolation like everything else.  Within this directory, there is 
a folder called "other_project".  This folder contains a terraform project that has already generated resources, and so
it has a populated tfstate file for us to reference.  If you run the following in the current directory, you will get 
an output from the statefile in "other_project", not the bucket created by this project.

```bash
terraform output other_bucket
```

If you got "blep-20190110063357193700000001" then this worked successfully.  Take some time you look at the usage of the 
remote_state data resource and how its implemented in this exercise and play around with it a bit.  Are you able to 
create another project and get outputs from that project?

### Direct JSON Parse

Since the tfstate files are just JSON files, given the appropriate level of motivation, you could parse it 
directly to get the information you need.  I don't really consider this a feature of terraform, but rather a side-effect
of the way state files and setup, so we won't be doing this in this exercise.